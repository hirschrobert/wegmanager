name: WEG Manager debian build test
on:
  push:
    branches:
      - main
      - '**dev**'
  pull_request:
    branches:
      - main
      - '**dev**'

jobs:
  debian-build-test:
    runs-on: ubuntu-20.04
    timeout-minutes: 10
    name: Build Package
    steps:
    - run: echo "ðŸŽ‰ Job triggered by ${{ github.event_name }} event, runs on a ${{ runner.os }} server."
    - name: Check out repository code
      uses: actions/checkout@v2
    - run: echo "ðŸ’¡ Branch ${{ github.ref }} of ${{ github.repository }} repository has been cloned to the runner."
    - name: Install Ubuntu build depenencies
      id: ubuntu-dependencies
      run: |
        sudo add-apt-repository ppa:jyrki-pulliainen/dh-virtualenv
        sudo add-apt-repository add-apt-repository ppa:deadsnakes/ppa
        sudo apt-get install -y devscripts dh-virtualenv debhelper build-essential python3-virtualenv python3.10
    - name: Install Python depenencies
      id: python-dependencies
      run: |
        sudo apt-get install -y libjpeg-dev libtiff5-dev libjpeg8-dev libopenjp2-7-dev zlib1g-dev libfreetype6-dev liblcms2-dev libwebp-dev tcl8.6-dev tk8.6-dev python3-tk libharfbuzz-dev libfribidi-dev libxcb1-dev libgraphviz-dev graphviz
        python3.10 -m pip install --upgrade pip
        python3.10 -m pip install --user pipenv
    - name: Install dependencies from project Pipfile
      id: project-dependencies
      run: pipenv install --dev
    - name: pylint
      run: pipenv run pylint ./wegmanager/  
    - name: Run build in pipenv
      run: PIPENV_DOTENV_LOCATION=build.env pipenv run debuild -b -us -uc
